<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Congestion Simulation - utxos.org -- Bitcoin for Everyone</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon-32x32.png><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link rel=stylesheet href=/css/style.min.001cd82c5deb4a55f69f076992dd043b44db7bc374aefabccae88643876b11a8.css></head><body class="page page-default-single"><div id=main-menu-mobile class=main-menu-mobile><ul><li class=menu-item-home><a href=/><span>Home</span></a></li><li class="menu-item-bip-119 materials dropdown show"><a class=dropdown-toggle href=# role=button id=dropdownMenuLink data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>BIP-119 Materials</span></a><div class=dropdown-menu aria-labelledby=dropdownMenuLink><div class=dropdown-item><a href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki style=color:#000>Specification</a></div><div class=dropdown-item><a href=https://github.com/bitcoin/bitcoin/pull/21702 style=color:#000>Core Pull Request</a></div><div class=dropdown-item><a href=/deployment/ style=color:#000>Deployment Options</a></div><div class=dropdown-item><a href=/alternatives/ style=color:#000>Alternative Designs</a></div><div class=dropdown-item><a href=/workshops/ style=color:#000>Workshops</a></div></div></li><li class="menu-item-applications dropdown show"><a class=dropdown-toggle href=# role=button id=dropdownMenuLink data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Applications</span></a><div class=dropdown-menu aria-labelledby=dropdownMenuLink><div class=dropdown-item><a href=/uses/ style=color:#000>Use Cases</a></div><div class=dropdown-item><a href=/analysis/ style=color:#000>Ecosystem Impact</a></div><div class=dropdown-item><a href=https://learn.sapio-lang.org style=color:#000>Sapio</a></div></div></li><li class=menu-item-signals><a href=/signals/><span>Signals</span></a></li><li class="menu-item-more resources"><a href=/resources/><span>More Resources</span></a></li><li class=menu-item-sponsors><a href=/sponsors/><span>Sponsors</span></a></li><li class=menu-item-telegram><a href=https://t.me/op_ctv_chat><span>Telegram</span></a></li></ul></div><div class=wrapper><div class=header><div class=container><div class=logo><a href=https://utxos.org><img alt=utxos.org src=/images/logo.svg></a></div><div class=logo-mobile><a href=https://utxos.org><img alt=utxos.org src=/images/logo-mobile.svg></a></div><div id=main-menu class=main-menu><ul><li class=menu-item-home><a href=/><span>Home</span></a></li><li class="dropdown show"><a class="btn dropdown-toggle" href=# role=button id=dropdownMenuLink data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>BIP-119 Materials</span></a><div class=dropdown-menu aria-labelledby=dropdownMenuLink><div class=dropdown-item><a href=https://github.com/bitcoin/bips/blob/master/bip-0119.mediawiki>Specification</a></div><div class=dropdown-item><a href=https://github.com/bitcoin/bitcoin/pull/21702>Core Pull Request</a></div><div class=dropdown-item><a href=/deployment/>Deployment Options</a></div><div class=dropdown-item><a href=/alternatives/>Alternative Designs</a></div><div class=dropdown-item><a href=/workshops/>Workshops</a></div></div></li><li class="dropdown show"><a class="btn dropdown-toggle" href=# role=button id=dropdownMenuLink data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Applications</span></a><div class=dropdown-menu aria-labelledby=dropdownMenuLink><div class=dropdown-item><a href=/uses/>Use Cases</a></div><div class=dropdown-item><a href=/analysis/>Ecosystem Impact</a></div><div class=dropdown-item><a href=https://learn.sapio-lang.org>Sapio</a></div></div></li><li class=menu-item-signals><a href=/signals/><span>Signals</span></a></li><li class="menu-item-more resources"><a href=/resources/><span>More Resources</span></a></li><li class=menu-item-sponsors><a href=/sponsors/><span>Sponsors</span></a></li><li class=menu-item-telegram><a href=https://t.me/op_ctv_chat><span>Telegram</span></a></li></ul></div><button id=toggle-main-menu-mobile class="hamburger hamburger--slider" type=button aria-label="Mobile Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button></div></div><div class="container pb-6 pt-6 pt-md-10 pb-md-10"><div class="row justify-content-start"><div class="offset-1 col-10 col-md-10"><div class="service service-single"><h1 class=title>Congestion Simulation</h1><h2 class=byline>by <a href=https://twitter.com/JeremyRubin>Jeremy Rubin</a></h2><div class=content><p><em>An earlier version of this document used the poission distribution of the average block interval rahter than the exponential, which led to innacurate results. A discussion of this error can be found <a href=https://twitter.com/JeremyRubin/status/121361540300123750>here</a>. The error in the code has been corrected in the following article, but the diagrams still need to be re-generated.</em></p><p>The below simulation results show that OP_CHECKTEMPLATEVERIFY is an effective too to
reduce network strain in Bitcoin. This is based on the same simulation used in the BIP.</p><p><img src=simulation.png alt></p><p>The chart shows how the Bitcoin Mempool will respond during two periods of intense transaction
demand. During the first period, rates go back to zero. In the second period, rates remain at the
max transactions per second threshold.</p><p>The last chart shows that the Mempool is much less congested when using OP_CHECKTEMPLATEVERIFY than
without it.</p><h2 id=walkthrough>Walkthrough</h2><p>This section walks through the code to show how the simulation was generated.</p><p>These are some basic parameters. They can be modified to change the behavior of
the simulation. The most important parameters to consider are <code>COMPRESSABLE</code>,
which informs us what percent of demand can go into OP_CHECKTEMPLATEVERIFY.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span>PHASES <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>PHASE_LENGTH <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>SAMPLES <span style=color:#f92672>=</span> PHASE_LENGTH <span style=color:#f92672>*</span> PHASES
</span></span><span style=display:flex><span>AVG_TX <span style=color:#f92672>=</span> <span style=color:#ae81ff>235</span>
</span></span><span style=display:flex><span>MAX_BLOCK_SIZE <span style=color:#f92672>=</span> <span style=color:#ae81ff>1e6</span>
</span></span><span style=display:flex><span>AVG_INTERVAL <span style=color:#f92672>=</span> <span style=color:#ae81ff>10.0</span><span style=color:#f92672>*</span><span style=color:#ae81ff>60.0</span>
</span></span><span style=display:flex><span>TXNS_PER_SEC <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.5</span><span style=color:#f92672>*</span>MAX_BLOCK_SIZE<span style=color:#f92672>/</span>AVG_TX<span style=color:#f92672>/</span>AVG_INTERVAL
</span></span><span style=display:flex><span>COMPRESSABLE <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.50</span>
</span></span><span style=display:flex><span>BRANCHING_FACTOR <span style=color:#f92672>=</span> <span style=color:#ae81ff>4.0</span>
</span></span><span style=display:flex><span>EXTRA_WORK_MULTIPLIER <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>/</span>(<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>/</span>BRANCHING_FACTOR)
</span></span><span style=display:flex><span>DAYS <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(range(SAMPLES))<span style=color:#f92672>/</span><span style=color:#ae81ff>144.0</span>
</span></span><span style=display:flex><span>DAYS_OFFSET <span style=color:#f92672>=</span> PHASES<span style=color:#f92672>/</span><span style=color:#ae81ff>144.0</span><span style=color:#f92672>*</span>PHASE_LENGTH
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>show_legend</span>(for_):
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>legend(for_, [l<span style=color:#f92672>.</span>get_label() <span style=color:#66d9ef>for</span> l <span style=color:#f92672>in</span> for_], loc<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;upper left&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>rcParams[<span style=color:#e6db74>&#34;font.size&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;31&#34;</span>
</span></span></code></pre></div><p>The function <code>get_rate</code> tells our simulation how to generate the curve of transactions per second.
Modifying it would allow you to simulate different demand curves.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_rates</span>(phase):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> phase <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>20</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> TXNS_PER_SEC
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> phase <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>10</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1.25</span><span style=color:#f92672>**</span>(<span style=color:#ae81ff>20</span> <span style=color:#f92672>-</span> phase) <span style=color:#f92672>*</span>TXNS_PER_SEC
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> phase <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>5</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1.25</span><span style=color:#f92672>**</span>(phase<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>)<span style=color:#f92672>*</span>TXNS_PER_SEC
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> TXNS_PER_SEC
</span></span><span style=display:flex><span>rates <span style=color:#f92672>=</span> [generate_rates(phase) <span style=color:#66d9ef>for</span> phase <span style=color:#f92672>in</span> range(PHASES<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>)] <span style=color:#f92672>+</span> 
</span></span><span style=display:flex><span>        [generate_rates(phase)<span style=color:#f92672>*</span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>for</span> phase <span style=color:#f92672>in</span> range(PHASES<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>)]
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_rate</span>(phase):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> rates[phase]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>subplot(<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span><span style=color:#f92672>*</span>COMPRESSABLE
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#34;Transaction Compression Performance with </span><span style=color:#e6db74>%d%%</span><span style=color:#e6db74> Adoption During 2 Spikes&#34;</span><span style=color:#f92672>%</span>p)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>ylabel(<span style=color:#e6db74>&#34;Txn/s&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p_full_block, <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>plot([DAYS[<span style=color:#ae81ff>0</span>], DAYS[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]],
</span></span><span style=display:flex><span>        [MAX_BLOCK_SIZE<span style=color:#f92672>/</span>AVG_TX<span style=color:#f92672>/</span>AVG_INTERVAL]<span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>         label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Maximum Average Transactions Per Second&#34;</span>)
</span></span><span style=display:flex><span>T <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(range(<span style=color:#ae81ff>0</span>, SAMPLES, PHASE_LENGTH))<span style=color:#f92672>/</span><span style=color:#ae81ff>144.0</span>
</span></span><span style=display:flex><span>p5, <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>plot(T, rates, <span style=color:#e6db74>&#34;k-&#34;</span>, label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Transactions Per Second&#34;</span>)
</span></span><span style=display:flex><span>show_legend([p5, p_full_block])
</span></span></code></pre></div><p><code>compressed()</code> simulates a network running where a portion of users use OP_CHECKTEMPLATEVERIFY.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>compressed</span>(compressable <span style=color:#f92672>=</span> COMPRESSABLE):
</span></span><span style=display:flex><span>    backlog <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    postponed_backlog <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e># reserve space for results</span>
</span></span><span style=display:flex><span>    results_confirmed <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>]<span style=color:#f92672>*</span>SAMPLES
</span></span><span style=display:flex><span>    results_unconfirmed <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>]<span style=color:#f92672>*</span>SAMPLES
</span></span><span style=display:flex><span>    results_yet_to_spend <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>]<span style=color:#f92672>*</span>SAMPLES
</span></span><span style=display:flex><span>    total_time <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>]<span style=color:#f92672>*</span>(SAMPLES)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> phase <span style=color:#f92672>in</span> range(PHASES):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> sample_idx <span style=color:#f92672>in</span> range(PHASE_LENGTH<span style=color:#f92672>*</span>phase, PHASE_LENGTH<span style=color:#f92672>*</span>(<span style=color:#ae81ff>1</span><span style=color:#f92672>+</span>phase)):
</span></span><span style=display:flex><span>			<span style=color:#75715e># Sample how much time until the next block</span>
</span></span><span style=display:flex><span>            total_time[sample_idx] <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>exponential(AVG_INTERVAL)
</span></span><span style=display:flex><span>			<span style=color:#75715e># Random sample a number of transactions that occur in this block time period</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># Equivalent to the sum of one poisson per block time</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># I.E., \sum_1_n Pois(a) = Pois(a*n)</span>
</span></span><span style=display:flex><span>            txns <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>poisson(get_rate(phase)<span style=color:#f92672>*</span>total_time[sample_idx])
</span></span><span style=display:flex><span>            postponed <span style=color:#f92672>=</span> txns <span style=color:#f92672>*</span> compressable
</span></span><span style=display:flex><span>			<span style=color:#75715e># Add the non postponed transactions to the backlog as the available weight</span>
</span></span><span style=display:flex><span>            weight <span style=color:#f92672>=</span> (txns<span style=color:#f92672>-</span>postponed)<span style=color:#f92672>*</span>AVG_TX <span style=color:#f92672>+</span> backlog
</span></span><span style=display:flex><span>			<span style=color:#75715e># Add the postponed to the postponed_backlog</span>
</span></span><span style=display:flex><span>            postponed_backlog <span style=color:#f92672>+=</span> postponed<span style=color:#f92672>*</span>AVG_TX <span style=color:#f92672>*</span> EXTRA_WORK_MULTIPLIER <span style=color:#75715e># Total extra work</span>
</span></span><span style=display:flex><span>			
</span></span><span style=display:flex><span>			<span style=color:#75715e># If we have more weight available than block space</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> weight <span style=color:#f92672>&gt;</span> MAX_BLOCK_SIZE:
</span></span><span style=display:flex><span>				<span style=color:#75715e># clear what we can -- 1 MAX_BLOCK_SIZE</span>
</span></span><span style=display:flex><span>                results_confirmed[sample_idx] <span style=color:#f92672>+=</span> MAX_BLOCK_SIZE
</span></span><span style=display:flex><span>                backlog <span style=color:#f92672>=</span> weight <span style=color:#f92672>-</span> MAX_BLOCK_SIZE
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>				<span style=color:#75715e># Otherwise, we have some space to spare for postponed backlog</span>
</span></span><span style=display:flex><span>                space <span style=color:#f92672>=</span> MAX_BLOCK_SIZE <span style=color:#f92672>-</span> weight
</span></span><span style=display:flex><span>                postponed_backlog <span style=color:#f92672>=</span> max(postponed_backlog<span style=color:#f92672>-</span>space, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                backlog <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e># record results in terms of transactions</span>
</span></span><span style=display:flex><span>            results_unconfirmed[sample_idx] <span style=color:#f92672>=</span> float(backlog)<span style=color:#f92672>/</span>AVG_TX
</span></span><span style=display:flex><span>            results_yet_to_spend[sample_idx] <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>                        postponed_backlog<span style=color:#f92672>/</span>EXTRA_WORK_MULTIPLIER<span style=color:#f92672>/</span>AVG_TX
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> results_unconfirmed, results_yet_to_spend, np<span style=color:#f92672>.</span>cumsum(total_time)<span style=color:#f92672>/</span>(<span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>60</span><span style=color:#f92672>*</span><span style=color:#ae81ff>24.0</span>)
</span></span><span style=display:flex><span>compressed_txs, unspendable, blocktimes_c <span style=color:#f92672>=</span> compressed()
</span></span></code></pre></div><p><code>normal()</code> simulates a network running where no users use OP_CHECKTEMPLATEVERIFY.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>normal</span>():
</span></span><span style=display:flex><span>    a,_,b <span style=color:#f92672>=</span> compressed(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> a,b
</span></span><span style=display:flex><span>normal_txs, blocktimes_n <span style=color:#f92672>=</span> normal()
</span></span></code></pre></div><p>Now we just glue the data together to display it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>subplot(<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>ylabel(<span style=color:#e6db74>&#34;Pending Txns&#34;</span>)
</span></span><span style=display:flex><span>p7, <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>plot(blocktimes_c1, unspendable,
</span></span><span style=display:flex><span>			   label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Confirmed Congestion Control Pending&#34;</span>)
</span></span><span style=display:flex><span>show_legend([p7])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>subplot(<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>ylabel(<span style=color:#e6db74>&#34;Mempool Txns&#34;</span>)
</span></span><span style=display:flex><span>p1, <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>plot(blocktimes_n, normal_txs,
</span></span><span style=display:flex><span>			   label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Unconfirmed Mempool without Congestion Control&#34;</span>)
</span></span><span style=display:flex><span>p3, <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>plot(blocktimes_c1, compressed_txs,
</span></span><span style=display:flex><span>			   label<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Unconfirmed Mempool with Congestion Control&#34;</span>)
</span></span><span style=display:flex><span>show_legend([p1, p3])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>xlabel(<span style=color:#e6db74>&#34;Block Days&#34;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><h2 id=limitations>Limitations</h2><p>Simulations are cheap facsimiles of reality; they does not generally accurately
model the universe. Even simulations generated by replaying real past events
do not predict what will happen in the future.</p><p>This simulation in particular makes some strong assumptions about miner
behavior. Miners always fill blocks as much as possible. In actuality, miners
often mine blocks which aren&rsquo;t full even when there is a backlog of
transactions.</p><p>This simulation does not make any attempt at estimating the fees savings. Fees may be non-linearly
correlated with the mempool length, or they may be wholly unaffected depending on consumer behavior,
which can be measured empirically, but does not necessarily predict future behavior. A good example
of why past data may not be predictive is that people may care to have transactions confirmed much
more in response to political news.</p><p>This simulation also does not address Jevons Paradox &ndash; whereby by making a
system more efficient to use, net consumption is increased, rather than
decreased. Such market questions are beyond the scope of the simulation.</p><p>Fortunately, for many of the mismatches between expectation and reality this
simulation is somewhat robust as a comparative measure. Unless miners are
specifically discriminating against <code>OP_CHECKTEMPLATEVERIFY</code> transactions, what the
results demonstrate is that <code>OP_CHECKTEMPLATEVERIFY</code> will perform better than the
corresponding behavior that would be seen without <code>OP_CHECKTEMPLATEVERIFY</code>.</p><p>Thus, we can show that <code>OP_CHECKTEMPLATEVERIFY</code> conveys a benefit across a wide variety of
scenarios. For example, replacing <code>get_rate()</code> with</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>rates <span style=color:#f92672>=</span> [np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>poisson(<span style=color:#ae81ff>7</span>) <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(PHASES<span style=color:#f92672>/</span><span style=color:#ae81ff>4</span>)]  <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>		[np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>poisson(<span style=color:#ae81ff>14</span>) <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(PHASES<span style=color:#f92672>/</span><span style=color:#ae81ff>4</span>)] <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span> 		[np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>poisson(<span style=color:#ae81ff>3</span>) <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(PHASES<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>)]
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_rate</span>(phase):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> rates[phase]
</span></span></code></pre></div><p>yields:</p><p><img src=random.png alt></p><p>The simulation framework can also show smaller adoption cases, e.g.
<code>COMPRESSABLE = 0.04</code>. In this scenario we see the global mempool does not
benefit as much, but the 4% of users who adopt <code>OP_CHECKTEMPLATEVERIFY</code> benefit
greatly by not having to compete with the mempool.</p><p><img src=random2.png alt></p></div></div></div></div><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//utxos-org.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class=footer><div class=container><div class=row><div class=col-12><div class=footer-inner><h3 class=footer-title>utxos.org -- Bitcoin for Everyone</h3><ul></ul></div></div></div></div></div><script type=text/javascript src=/js/scripts.min.8504133605a277da18f0d58cfd2e90d154962f4a961543a6e2f0a459a2d05462.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-152627278-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-152627278-1")</script><link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,400i|IBM+Plex+Sans+Condensed:400,400i|IBM+Plex+Sans:100,100i,400,400i,700,700i|IBM+Plex+Serif:400,400i&display=swap" rel=stylesheet><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js integrity=sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1 crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script></body></html>